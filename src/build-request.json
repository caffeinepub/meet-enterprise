{
  "kind": "build_request",
  "title": "Remove remaining Internet Identity dependencies and unblock username/password signup",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Remove Internet Identity usage from the username/password sign-up flow so users can create an account without requiring `useInternetIdentity()` and without showing the error message “Please enable guest mode or sign in to continue”.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Same message is given"
        ]
      },
      "acceptanceCriteria": [
        "`frontend/src/pages/account/AccountSignupPage.tsx` no longer imports or calls `useInternetIdentity()`.",
        "Submitting the sign-up form does not block on `identity` being present.",
        "The toast/error “Please enable guest mode or sign in to continue” is no longer shown during normal sign-up.",
        "A user can complete sign-up and be redirected to `/profile` (or an equivalent logged-in destination) without any navigation/redirect to Internet Identity (id.ai)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Replace Internet Identity-based “authenticated” checks in account/auth UI with backend-derived role/session state so the app never depends on `useInternetIdentity()` for gating pages or rendering “Sign In/Logout” states.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Yes remove it all"
        ]
      },
      "acceptanceCriteria": [
        "`frontend/src/pages/account/AccountLoginPage.tsx`, `frontend/src/pages/account/AccountPage.tsx`, `frontend/src/components/auth/RequireAuth.tsx`, `frontend/src/components/auth/LoginButton.tsx`, and `frontend/src/components/layout/AppShell.tsx` no longer import or call `useInternetIdentity()`.",
        "Auth gating and logged-in UI state is determined without `identity` (e.g., using existing backend role queries and/or a local guest flag).",
        "No buttons or auth gates trigger any Internet Identity login/redirect flows."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Update backend authorization so username/password sign-up can succeed without Internet Identity by allowing a guest caller to set credentials and be upgraded to a user role during sign-up.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Yes remove it all"
        ]
      },
      "acceptanceCriteria": [
        "`setCredentials` no longer traps for callers who are not already `#user` if they are at least a guest, and it results in the caller being treated as a `#user` after successful credential creation.",
        "After credentials are set, calls that require `#user` permissions (e.g., profile save/read) work for that same caller without needing any Internet Identity login.",
        "Backend changes do not introduce additional external services or additional canisters (single-actor constraint preserved)."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Ensure routing/navigation related to authentication uses only in-app pages (e.g., `/account/signup`, guest mode) and never links to or redirects to Internet Identity (id.ai).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Same message is given"
        ]
      },
      "acceptanceCriteria": [
        "Navigating through Account, Sign Up, and protected pages does not open external identity provider pages.",
        "Protected pages either render content for users/guests (as intended) or show the in-app “Sign In or Continue as Guest” card without any Internet Identity references or redirects."
      ]
    }
  ],
  "constraints": [
    "Do not edit any files under `frontend/src/components/ui` (compose them only).",
    "Do not edit immutable paths: `frontend/src/hooks/useInternetIdentity.ts`, `frontend/src/hooks/useInternetIdentity.tsx`, `frontend/src/hooks/useActor.ts`, `frontend/src/main.tsx`, `frontend/src/components/ui`.",
    "Backend must remain a single Motoko actor with all logic in `backend/main.mo`; create `backend/migration.mo` only if a state upgrade is required."
  ],
  "nonGoals": [
    "Implementing third-party authentication providers (only in-app username/password + guest mode).",
    "Adding external databases or off-chain storage.",
    "Adding real-time features (WebSockets, push notifications, etc.)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}